<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slink-多功能短链系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f517.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://blog2.811520.xyz/slink/css/main.css">
    <link rel="stylesheet" href="https://blog2.811520.xyz/slink/css/common.css">
    
    <style>
        .container { min-height: calc(100vh - 40px); display: flex; flex-direction: column; }
        .card-body { padding: 20px 20px 10px 20px; overflow: hidden; }
        .row { flex-grow: 1; align-items: stretch; }
        .left-column-stack { display: flex; flex-direction: column; gap: 20px; height: 100%; }
        .list-card-body { flex-grow: 1; min-height: 0; display: flex; flex-direction: column; }
        #urlList { flex-grow: 1; padding-right: 5px; }
        .right-column-card { height: 100%; }
        .card-body.preview-body { flex-grow: 1; display: flex; flex-direction: column; padding-bottom: 20px; }
        .markdown-preview { flex-grow: 1; min-height: 200px; overflow-y: auto; border: 1px solid var(--border-color);  padding: 15px; border-radius: .375rem; background-color: var(--input-bg); }
        @media (max-width: 768px) {
            .container { min-height: 100vh; }
            .row { flex-grow: 0; align-items: flex-start; }
            .left-column-stack, .right-column-card { height: auto; }
            .col-lg-6.mb-4 { margin-bottom: 20px !important; }
            .col-lg-6.mb-4:last-child { margin-bottom: 0 !important; }
            .list-card-body, .card-body.preview-body { flex-grow: 0; min-height: auto; }
            #urlList { flex-grow: 0; max-height: 500px; padding-right: 0; }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="text-center mb-4">
            <h1 class="display-5 fw-bold mb-3">
                <i class="fas fa-note-sticky me-2"></i>在线记事本
            </h1>
            <p class="lead fw-medium">基于 CF Worker 和 KV 创建的在线记事本服务</p>
        </div>

        <div class="row">
            
            <div class="col-lg-6 mb-4">
                <div class="left-column-stack">
                    
                    <div class="card shadow">
                        <div class="card-header"><i class="fas fa-edit me-2"></i>编辑笔记</div>
                        <div class="card-body">
                            
                            <div class="mb-3">
                                <label for="longURL" class="form-label fw-bold">笔记内容 (支持 Markdown)</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-pencil-alt"></i></span>
                                    <textarea class="form-control" id="longURL" rows="8"
                                        placeholder="输入的文本或 Markdown" oninput="syncMarkDownView()"></textarea> 
                                </div>
                            </div>

                            <div class="mb-3" id="customLinkContainer">
                                <label for="keyPhrase" class="form-label fw-bold">自定义文件名（可选）</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                    <input type="text" class="form-control" id="keyPhrase" placeholder="示例: my-note.md"
                                        onkeypress="shorturl(event)">
                                    <button class="btn btn-outline-primary" type="button" id="addBtn" onclick="shorturl()">
                                        <i class="fas fa-save me-2"></i>保存
                                    </button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">查询笔记</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="keyForQuery" placeholder="输入 Key 查询笔记链接"
                                        onkeypress="if(event.keyCode === 13) query1KV()">
                                    <button class="btn btn-outline-primary" type="button" onclick="query1KV()">
                                        <i class="fas fa-external-link-alt me-2"></i>查询
                                    </button>
                                </div>
                            </div>
                            <input type="hidden" id="passwordText" value="__PASSWORD__">
                        </div>
                    </div>

                    <div class="card shadow flex-grow-1">
                        <div class="card-header"><i class="fas fa-list me-2"></i>链接管理</div>
                        <div class="card-body list-card-body">
                            <div class="d-flex justify-content-between mb-3">
                                <button class="btn btn-success btn-sm" type="button" id="loadListBtn" onclick="loadUrlList()">
                                    <i class="fas fa-sync-alt me-2"></i>刷新列表
                                </button>
                                <button class="btn btn-danger btn-sm" type="button" id="clearlocalStgBtn" onclick="clearLocalStorage(); loadUrlList()">
                                    <i class="fas fa-trash-alt me-2"></i>清空本地
                                </button>
                                <button class="btn btn-primary btn-sm" type="button" id="loadKV2localStgBtn" onclick="loadKV()">
                                    <i class="fas fa-cloud-download-alt me-2"></i>从KV加载
                                </button>
                            </div>

                            <div class="card-text flex-grow-1">
                                <div class="list-group" id="urlList">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card shadow right-column-card">
                    <div class="card-header"><i class="fas fa-eye me-2"></i>Markdown 预览</div>
                    <div class="card-body preview-body"> 
                        <div id="html-preview" class="markdown-preview">
                            <p>在左侧输入 Markdown 文本可实时预览</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="resultModalLabel">
                        <i class="fas fa-check-circle me-2"></i>生成结果
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="关闭"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info" id="result">暂无结果</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="copyResultBtn">
                        <i class="fas fa-copy me-2"></i>复制
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>关闭
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/lrsjng/jquery-qrcode@0.18.0/dist/jquery-qrcode.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> 
    <script src="https://blog2.811520.xyz/slink/js/main.js" crossorigin="anonymous"></script>
    <script src="https://blog2.811520.xyz/slink/js/theme.js" crossorigin="anonymous"></script>
    <script src="https://blog2.811520.xyz/slink/js/footer.js" crossorigin="anonymous"></script>
    
    <script>
        function syncMarkDownView() {
            const markdownContent = document.getElementById('longURL').value;
            const htmlPreview = document.getElementById('html-preview');
            htmlPreview.innerHTML = marked.parse(markdownContent);
        }
        document.getElementById('longURL').addEventListener('input', syncMarkDownView);
        document.addEventListener('DOMContentLoaded', syncMarkDownView);

        function buildValueMarkdown(longUrl) {
            let valueMarkdown = document.createElement('div');
            valueMarkdown.classList.add("form-control", "text-start");
            valueMarkdown.style.whiteSpace = 'pre-wrap';
            valueMarkdown.style.maxHeight = '150px'; 
            valueMarkdown.style.overflowY = 'hidden'; 
            valueMarkdown.innerHTML = marked.parse(longUrl);
            return valueMarkdown;
        }

        buildValueItemFunc = buildValueMarkdown; 
    </script>
</body>
</html>


